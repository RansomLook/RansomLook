{% extends "base.html" %}
{% from 'bootstrap5/utils.html' import render_messages %}
{% block title %}Admin · Crypto{% endblock %}
{% block content %}
{{ render_messages(container=True, dismissible=True) }}

<section class="hero">
  <div class="container">
    <h1>Crypto — Select or Create Group</h1>
    <p class="lead">Choose a group to manage its wallets, or create a new one (DB=7 only).</p>
  </div>
</section>

<section class="metrics-section">
  <div class="container">

    <div class="table-card" style="padding:12px;">
      <div style="display:flex;gap:12px;align-items:center;flex-wrap:wrap;">
        <input id="search" type="search" placeholder="Search group…" style="flex:1;min-width:240px;padding:8px;">
        <a class="btn" href="{{ url_for('admin_crypto_group_new') }}" title="Create group in DB=7">Create group</a>
        <a class="btn" href="{{ url_for('admin_crypto_aliases') }}" title="Manage crypto aliases (DB=7)">Aliases</a>
      </div>
    </div>

    <div class="table-card" style="margin-top:12px;">
      <div class="table-scroll">
        <table class="rl-table" id="groups-table" aria-label="Groups">
          <thead>
            <tr>
              <th>Group</th>
              <th style="width:15%;text-align:right">Addresses</th>
              <th style="width:20%;text-align:center">Actions</th>
            </tr>
          </thead>
          <tbody>
          {% for row in groups %}
            <tr data-name="{{ row.name|lower }} {{ (row.aliases|join(' ')) if row.aliases }}">
              <td>
                <strong>{{ row.name }}</strong>
                {% if row.aliases and row.aliases|length %}
                  <small class="muted">— aliases: {{ row.aliases|join(', ') }}</small>
                {% endif %}
              </td>
              <td style="text-align:right">{{ row.count }}</td>
              <td style="text-align:center">
                <a class="btn" href="{{ url_for('admin_crypto_group', group=row.name) }}">Manage</a>
              </td>
            </tr>
          {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

  </div>
</section>

<script>
(function(){
  const q = document.getElementById('search');
  const rows = Array.from(document.querySelectorAll('#groups-table tbody tr'));
  if (!q) return;
  q.addEventListener('input', function(){
    const v = (this.value || '').toLowerCase();
    rows.forEach(tr => {
      const tokens = (tr.dataset.name || '').toLowerCase();
      tr.style.display = !v || tokens.includes(v) ? '' : 'none';
    });
  });
})();
</script>
{% endblock %}
