{% extends "base.html" %}
{% from 'bootstrap5/utils.html' import render_messages %}
{% block title %}Admin · Crypto — {{ group }}{% endblock %}
{% block content %}
{{ render_messages(container=True, dismissible=True) }}

<section class="hero">
  <div class="container">
    <h1>Manage wallets — {{ group }}</h1>
    <p class="lead">Add, edit or remove addresses for this group.</p>
  </div>
</section>

<section class="metrics-section">
  <div class="container">

    <div class="table-card" style="padding:12px;margin-bottom:12px;">
      <a class="btn" href="{{ url_for('admin_crypto_new', group=group) }}">Add address</a>
      <a class="btn" href="{{ url_for('admin_crypto') }}">Back to groups</a>
    </div>

    {% for chain, wallets in by_chain.items() %}
      <details open class="section-block">
        <summary class="section-summary">
          <span class="mono">{{ chain }}</span>
          <span class="count">{{ wallets|length }}</span>
        </summary>

        <div class="table-card">
          <div class="table-scroll">
            <table class="rl-table" aria-label="Wallets">
              <thead>
                <tr>
                  <th>Blockchain</th>
                  <th>Address</th>
                  <th>Source</th>
                  <th style="width:18%;text-align:right">Tx count</th>
                  <th style="width:20%;text-align:center">Actions</th>
                </tr>
              </thead>
              <tbody>
              {% for w in wallets %}
                <tr>
                  <td class="mono">{{ chain }}</td>
                  <td class="mono" style="word-break:break-all;"><code>{{ w.address }}</code></td>
                  <td>{{ w.source or 'unknown' }}</td>
                  <td style="text-align:right">{{ w.tx_count or (w.transactions|length) }}</td>
                  <td style="text-align:center">
                    <a class="btn" href="{{ url_for('admin_crypto_edit_addr', group=group, chain=chain, addr=w.address) }}">Edit</a>
                    <form method="post" action="{{ url_for('admin_crypto_edit_addr', group=group, chain=chain, addr=w.address) }}" style="display:inline" onsubmit="return confirm('Delete this address?');">
                      <input type="hidden" name="action" value="delete">
                      <button class="btn btn-danger" type="submit">Delete</button>
                    </form>
                  </td>
                </tr>
              {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </details>
    {% else %}
      <div class="table-card" style="padding:12px">No address yet for this group.</div>
    {% endfor %}

  </div>
</section>

{% endblock %}
